var Y=Object.defineProperty;var Z=(s,t,e)=>t in s?Y(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var f=(s,t,e)=>Z(s,typeof t!="symbol"?t+"":t,e);import{_ as N,t as l,v as d,x as n,d as W,J as X,r as A,o as J,B as u,y as P,K as c,L as k,M as Q,N as H,O as j,z as I,P as G,Q as C,R as K,i as R,S as V,T as D,U as E}from"./CjfthUDv.js";const tt={},nt={width:"800px",height:"800px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"icon"};function et(s,t){return l(),d("svg",nt,t[0]||(t[0]=[n("circle",{cx:"12",cy:"12",r:"10","stroke-width":"var(--stroke-width)"},null,-1),n("path",{d:"M15 12L12 12M12 12L9 12M12 12L12 9M12 12L12 15","stroke-width":"var(--stroke-width)","stroke-linecap":"round"},null,-1)]))}const st=N(tt,[["render",et]]),at={},it={width:"800px",height:"800px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",class:"icon",fill:"var(--border-color)"};function ot(s,t){return l(),d("svg",it,t[0]||(t[0]=[n("g",null,[n("g",null,[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M18.9792 32.3759L8.69035 39.3951C6.69889 40.7537 3.99878 39.3269 3.99878 36.917V11.005C3.99878 8.59361 6.69843 7.166 8.69028 8.52489L27.6843 21.4809C29.4304 22.672 29.4304 25.249 27.6843 26.4371L20.9792 31.0114V36.9144C20.9792 37.7185 21.8791 38.1937 22.5432 37.7406L41.5107 24.787C42.0938 24.3882 42.0938 23.5316 41.5112 23.1342L22.5436 10.1805C21.8791 9.72714 20.9792 10.2023 20.9792 11.0064V11.9464C20.9792 12.4987 20.5315 12.9464 19.9792 12.9464C19.4269 12.9464 18.9792 12.4987 18.9792 11.9464V11.0064C18.9792 8.59492 21.6789 7.16945 23.6711 8.52861L42.6387 21.4823C44.3845 22.6732 44.3845 25.2446 42.6391 26.4382L23.6707 39.3925C21.6789 40.7514 18.9792 39.3259 18.9792 36.9144V32.3759ZM18.9792 29.9548L7.56322 37.7429C6.89939 38.1958 5.99878 37.7199 5.99878 36.917V11.005C5.99878 10.2003 6.89924 9.72409 7.56321 10.1771L26.5573 23.1331C27.1391 23.53 27.1391 24.389 26.5582 24.7842L20.9792 28.5904V24.9184C20.9792 24.3661 20.5315 23.9184 19.9792 23.9184C19.4269 23.9184 18.9792 24.3661 18.9792 24.9184V29.9548Z"})])],-1)]))}const rt=N(at,[["render",ot]]);var i=(s=>(s[s.IDLE=0]="IDLE",s[s.WRITE=1]="WRITE",s[s.INIT=2]="INIT",s[s.GFXa=3]="GFXa",s[s.GFXb=4]="GFXb",s[s.SNAPb=5]="SNAPb",s[s.SNAPc=6]="SNAPc",s[s.SNAPd=7]="SNAPd",s[s.SNAPe=8]="SNAPe",s))(i||{});function M(s){switch(s){case i.IDLE:return"IDLE";case i.WRITE:return"WRITE";case i.INIT:return"INIT";case i.GFXa:return"GFXa";case i.GFXb:return"GFXb";case i.SNAPb:return"SNAPb";case i.SNAPc:return"SNAPc";case i.SNAPd:return"SNAPd";case i.SNAPe:return"SNAPe"}}class w extends Set{constructor(t){super(),t==null||t.forEach(e=>{e&&!this.has(e)&&this.add(e)})}values(){return super.values()}add(t){return t?super.add(t):this}has(t){if(!t)return!1;for(const e of this)if(this.isShallowMatch(e,t))return!0;return!1}isShallowMatch(t,e){return"nbWrite"in t&&"nbWrite"in e?t.proc===e.proc&&t.nbWrite===e.nbWrite:!("nbWrite"in t)&&!("nbWrite"in e)?t.proc===e.proc:!1}}class lt{constructor(t,e,a,o,p,r,h,v,b,y){f(this,"A1");f(this,"A2");f(this,"A3");f(this,"id");f(this,"nbWrite",0);f(this,"procEntry");f(this,"toWrite");f(this,"known");f(this,"notKnown");f(this,"oldNbParticipants");f(this,"nbParticipants");f(this,"state");f(this,"ranGFX",!1);this.id=t,this.A1=v,this.A2=b,this.A3=y,this.oldNbParticipants=r,this.nbParticipants=h,this.toWrite=p,this.known=a,this.notKnown=o,this.procEntry={proc:this.id},this.state=e}write(t){if(this.state.value!==i.IDLE)throw new Error("You can start a write only while idle");return this.state.value=i.WRITE,this.run(t)}run(t){switch(this.state.value){case i.IDLE:console.log("idle");return;case i.WRITE:if(t==null)throw new Error("You have to provide a fact");t!==""?this.toWrite.value={proc:this.id,nbWrite:this.nbWrite++,data:t}:this.toWrite.value=null,this.state.value=this.ranGFX?i.SNAPb:i.INIT,this.state.value===i.INIT&&this.run();break;case i.INIT:console.log("init"),this.init();break;case i.GFXa:console.log("gfxA"),this.gfxA();break;case i.GFXb:console.log("gfxB"),this.gfxB();break;case i.SNAPb:console.log("snapB"),this.snapB();break;case i.SNAPc:console.log("snapC"),this.snapC();break;case i.SNAPd:console.log("snapD"),this.snapD();break;case i.SNAPe:console.log("snapE"),this.snapE();break;default:throw new Error(`Unknown state ${this.state.value}`)}}init(){this.known.value=new w([this.procEntry]),this.notKnown.value=[],this.oldNbParticipants.value=0,this.nbParticipants.value=0,this.state.value=i.GFXa}gfxA(){let t=this.A1.value.map(a=>new w(a.data));for(let a of t)this.known.value=new w([...this.known.value,...a]);this.notKnown.value=[];const e=new w;for(let a=0;a<=this.known.value.size;a++){const o=a>=this.A1.value.length?e:this.A1.value[a].data;this.setEquals(o,this.known.value)||this.notKnown.value.push(a)}if(this.notKnown.value.length)this.state.value=i.GFXb;else{const a=this.known.value;this.writeToArray(this.A2.value,a.size-1,new w(a)),this.state.value=i.SNAPb,this.known.value=new w,this.notKnown.value=[]}}gfxB(){if(this.notKnown.value.length===0)throw new Error("notKnown should not be empty in GFXb");this.writeToArray(this.A1.value,this.notKnown.value[0],new w(this.known.value)),this.state.value=i.GFXa}snapB(){this.ranGFX=!0,this.known.value.add(this.toWrite.value),this.nbParticipants.value=this.countParticipants(),this.state.value=i.SNAPc}snapC(){this.oldNbParticipants.value=this.nbParticipants.value,this.A3.value.forEach(e=>{this.known.value=new w([...this.known.value,...e.data])}),this.notKnown.value=[];const t=new w;for(let e=0;e<this.nbParticipants.value;e++){const a=e>=this.A3.value.length?t:this.A3.value[e].data;this.setEquals(a,this.known.value)||this.notKnown.value.push(e)}this.notKnown.value.length>0?this.state.value=i.SNAPd:this.state.value=i.SNAPe}snapD(){this.writeToArray(this.A3.value,this.notKnown.value[0],new w(this.known.value)),this.state.value=i.SNAPc}snapE(){this.nbParticipants.value=this.countParticipants(),this.nbParticipants.value===this.oldNbParticipants.value?this.state.value=i.IDLE:this.state.value=i.SNAPc}writeToArray(t,e,a){for(;e>t.length;)t.push({idx:t.length,data:new w});e>=t.length?t.push({idx:e,data:a}):t[e].data=a}countParticipants(){let t=new w,e=this.A2.value.map(a=>new w(a.data));for(let a of e)t=new w([...t,...a]);return t.size}setEquals(t,e){if(t.size!==e.size)return!1;for(let a of t)if(!e.has(a))return!1;return!0}}const ct={class:"proc-container"},ut={key:0,class:"proc-control"},dt={key:0,class:"fact-container"},pt={key:1,class:"fact-container"},vt=W({__name:"process",props:{id:{},active:{type:Boolean}},emits:["activate"],setup(s,{emit:t}){const e=s,a=t,o=X("A1"),p=X("A2"),r=X("A3"),h=A(new w),v=A([]),b=A(0),y=A(0),S=A(null),_=A(i.IDLE),$=new lt(e.id,_,h,v,S,b,y,o,p,r),g=A("");function F(){a("activate",{state:_,toWrite:S,oldNbParticipant:b,nbParticipant:y,known:h,notKnown:v})}function z(){g.value||(g.value=""),$.write(g.value.trim()),g.value=""}function U(){$.run()}return J(()=>{F()}),(L,m)=>{const q=st,O=rt;return l(),d("div",ct,[n("div",{class:k(["proc-element",{glow:L.active}]),onClick:m[0]||(m[0]=T=>F())},[u(P(L.id),1),m[4]||(m[4]=n("br",null,null,-1)),n("label",null,P(("prettyState"in L?L.prettyState:c(M))(c(_))),1)],2),L.active?(l(),d("div",ut,[c(_)===c(i).IDLE?(l(),d("div",dt,[Q(n("input",{"onUpdate:modelValue":m[1]||(m[1]=T=>j(g)?g.value=T:null)},null,512),[[H,c(g)]]),n("button",{onClick:m[2]||(m[2]=T=>z())},[I(q)])])):(l(),d("div",pt,[n("button",{onClick:m[3]||(m[3]=T=>U())},[I(O)])]))])):G("",!0)])}}}),ht=N(vt,[["__scopeId","data-v-4945ca6d"]]);function B(s){return Array(...s).sort((t,e)=>{if(t.proc!=e.proc)return t.proc<e.proc?-1:1;if(!("nbWrite"in t&&t.nbWrite!==void 0&&"nbWrite"in e&&e.nbWrite!==void 0))throw new Error("proc is the same but nbWrite is not available");return t.nbWrite-e.nbWrite})}function x(s){let t="[";return t+=s.proc,"nbWrite"in s&&(t+=", "+s.nbWrite.toString()),"data"in s&&(t+=", "+s.data),t+"]"}const wt={key:0,class:"array-name mid"},bt={key:1,class:"code-container"},ft={class:"inner-container wide"},At={class:"data-line"},gt={key:0,class:"data"},Pt={class:"data-line"},_t={class:"data"},mt={class:"data-line"},kt={class:"data"},Nt={class:"data-line"},yt={class:"data"},St={class:"data-line"},It={class:"data"},$t={class:"data-line"},Wt={class:"data inline"},Ct=W({__name:"ProcessState",props:{state:{},activeProcess:{}},setup(s){const t=s;function e(){return t.state.toWrite.value?t.state.toWrite.value.data:null}function a(){return t.state.known?Array.from(t.state.known.value):[]}function o(){return t.state.notKnown?t.state.notKnown.value.sort():[]}return(p,r)=>(l(),d("span",null,[p.state!==null?(l(),d("div",wt,"P"+P(p.activeProcess)+" State",1)):G("",!0),p.state!==null?(l(),d("div",bt,[n("div",ft,[n("span",null,[n("span",At,[r[0]||(r[0]=n("label",null," State ",-1)),p.state?(l(),d("span",gt,P(("prettyState"in p?p.prettyState:c(M))(p.state.state.value)),1)):G("",!0)]),n("span",Pt,[r[1]||(r[1]=n("label",null," NEW FACT: ",-1)),n("span",_t,P(e()??"⟂"),1)]),n("span",mt,[r[2]||(r[2]=n("label",null," Old Nr. Participants: ",-1)),n("span",kt,P(p.state.oldNbParticipant),1)]),n("span",Nt,[r[3]||(r[3]=n("label",null," Current Nr. Participants: ",-1)),n("span",yt,P(p.state.nbParticipant),1)]),n("span",St,[r[4]||(r[4]=n("label",null," Known: ",-1)),n("span",It,[(l(!0),d(C,null,K(("sortArrayData"in p?p.sortArrayData:c(B))(a()),(h,v)=>(l(),d("div",{key:v},P(("formatArrayData"in p?p.formatArrayData:c(x))(h)),1))),128))])]),n("span",$t,[r[7]||(r[7]=n("label",null," NotKnown: ",-1)),n("span",Wt,[r[5]||(r[5]=u(" [ ")),(l(!0),d(C,null,K(o(),(h,v)=>(l(),d("div",{key:v},P(v>0?", "+h:h),1))),128)),r[6]||(r[6]=u(" ] "))])])])])])):G("",!0)]))}}),Kt=N(Ct,[["__scopeId","data-v-7692bef7"]]),Lt={class:"main-container",id:"procs-container"},Ft={class:"processes"},Tt={class:"inner-container left"},Dt=W({__name:"ProcessesList",props:{processes:{},activeProcess:{}},emits:["clicked","addProcess"],setup(s,{emit:t}){const e=s;let a=[];const o=t;function p(v,b){a[v]=b,o("clicked",v,b)}function r(){a.push({}),o("addProcess")}const h=R(()=>e.activeProcess>=0&&e.activeProcess<a.length?a[e.activeProcess]:null);return(v,b)=>{const y=ht,S=Kt;return l(),d("div",Lt,[b[0]||(b[0]=n("div",{class:"array-name"},"Processes",-1)),n("div",Ft,[n("div",Tt,[(l(!0),d(C,null,K(v.processes,(_,$)=>(l(),V(y,{key:_.id,id:_.id,active:$===v.activeProcess,ref_for:!0,ref:"processesEl",onActivate:g=>p($,g)},null,8,["id","active","onActivate"]))),128)),n("div",{class:"btn-container"},[n("button",{class:"add-proc-btn",onClick:r},"+")])])]),b[1]||(b[1]=n("div",{class:"divider"},null,-1)),I(S,{activeProcess:v.activeProcess,state:c(h)},null,8,["activeProcess","state"])])}}}),Gt=N(Dt,[["__scopeId","data-v-0a62dad4"]]),Xt={class:"register-container"},Et={class:"register-idx"},Rt={class:"data"},Vt=W({__name:"ArrayRegister",props:{register:{}},setup(s){return(t,e)=>(l(),d("div",Xt,[n("p",Et,P(t.register.idx),1),n("div",Rt,[e[0]||(e[0]=n("div",{class:"corner top left"},null,-1)),e[1]||(e[1]=n("div",{class:"corner top right"},null,-1)),e[2]||(e[2]=n("div",{class:"corner bottom left"},null,-1)),e[3]||(e[3]=n("div",{class:"corner bottom right"},null,-1)),(l(!0),d(C,null,K(c(B)(t.register.data),(a,o)=>(l(),d("p",{key:o},P(("formatArrayData"in t?t.formatArrayData:c(x))(a)),1))),128))])]))}}),Mt=N(Vt,[["__scopeId","data-v-1582a32c"]]),Bt={class:"array-name"},xt=["data-name"],zt=W({__name:"MWMRArray",props:{area:{},name:{},registers:{}},setup(s){return(t,e)=>{const a=Mt;return l(),d("div",{class:"main-container mwmrarray-container",style:D(`--area: ${t.area};`)},[n("div",Bt,P(t.name),1),n("div",{class:"array-container","data-name":t.name},[n("div",{class:"inner-container",style:D(`padding: ${t.registers.length===0?0:"auto"}`)},[(l(!0),d(C,null,K(t.registers,o=>(l(),V(a,{key:o.idx,register:o},null,8,["register"]))),128))],4),n("div",{class:"empty-regs",style:D(`height: ${t.registers.length===0?"auto":0}; --sibling-count:6; padding-top: ${t.registers.length===0?"2rem":""};`)},[(l(),d(C,null,K([1,2,3,4,5,6],o=>n("div",{key:o,class:"empty-data",style:D(`--sibling-index:${o}`)}," ∅ ",4)),64))],4)],8,xt)],4)}}}),Ut=N(zt,[["__scopeId","data-v-d7f11416"]]),qt={class:"main-container"},Ot={class:"code-container"},Yt={class:"inner-container no-gap"},Zt=W({__name:"ActiveCode",props:{state:{}},setup(s){const t=s;function e(){var a;return(a=t.state)==null?void 0:a.state.value}return(a,o)=>(l(),d("div",qt,[o[8]||(o[8]=n("div",{class:"array-name"},"Pseudo Code",-1)),n("div",Ot,[n("div",Yt,[n("div",{class:k(["code-block",{highlight:e()==c(i).IDLE}])},o[0]||(o[0]=[n("label",null,"IDLE",-1)]),2),n("div",{class:k(["code-block",{highlight:e()==c(i).INIT}])},o[1]||(o[1]=[n("label",null,"INIT",-1),n("pre",null,[u(""),n("b",null,"variables"),u(` A1 = [ i ∈ Nat -> {} ],
          A2 = [ i ∈ Nat -> {} ],
          A3 = [ i ∈ Nat -> {} ],
          myVals = {},
          out = {},
          known = {self},
          notKnown = {},
          oldNbParticipant = 0,
          nbParticipant = 0;
      `)],-1)]),2),n("div",{class:k(["code-block",{highlight:e()==c(i).GFXa}])},o[2]||(o[2]=[n("label",null,"GFXa",-1),n("pre",null,[u(`known := known ∪ NUnion(A1);
notKnown := { i ∈ 0 .. (|known|) :
                 known != A1[i] };

`),n("b",null,"if"),u(` ( notKnown == {} )
    A2[|known| - 1] = known
    known := {};
    notKnown := {};
    `),n("b",null,"goto"),u(` SNAPb;
      `)],-1)]),2),n("div",{class:k(["code-block",{highlight:e()==c(i).GFXb}])},o[3]||(o[3]=[n("label",null,"GFXb",-1),n("pre",null,[u(""),n("b",null,"with"),u(`( i ∈ notKnown ) { A1[i] := known }

`),n("b",null,"goto"),u(` GFXa
      `)],-1)]),2),n("div",{class:k(["code-block",{highlight:e()==c(i).SNAPb}])},o[4]||(o[4]=[n("label",null,"SNAPb",-1),n("pre",null,[u(""),n("b",null,"while"),u(` ( TRUE )
    `),n("b",null,"with"),u(` ( v ∈ Val ) { myVals := myVals ∪ {v} };
    known := myVals ∪ known;
    nbParticipant := |NUnion(A2)|;
      `)],-1)]),2),n("div",{class:k(["code-block",{highlight:e()==c(i).SNAPc}])},o[5]||(o[5]=[n("label",null,"SNAPc",-1),n("pre",null,[u(`    oldNbParticipant := nbParticipant;

    known := known ∪ NUnion(A3);
    notKnown := { i ∈ 0 .. (nbParticipant - 1) :
                      known != A3[i] };
    `),n("b",null,"if"),u(` ( notKnown == {} )
        `),n("b",null,"goto"),u(` SNAPe
      `)],-1)]),2),n("div",{class:k(["code-block",{highlight:e()==c(i).SNAPd}])},o[6]||(o[6]=[n("label",null,"SNAPd",-1),n("pre",null,[u("    "),n("b",null,"with"),u(` ( i ∈ notKnown ) { A3[i] := known }

    `),n("b",null,"goto"),u(` SNAPc
      `)],-1)]),2),n("div",{class:k(["code-block",{highlight:e()==c(i).SNAPe}])},o[7]||(o[7]=[n("label",null,"SNAPe",-1),n("pre",null,[u(`    nbParticipant := |NUnion(A2)|;

    `),n("b",null,"if"),u(` ( oldNbParticipant == nbParticipant )
        out := known;
    `),n("b",null,"else"),u(`
        `),n("b",null,"goto"),u(" SNAPc")],-1)]),2)])])]))}}),Jt=N(Zt,[["__scopeId","data-v-df1d9cc8"]]),Qt={class:"container"},Ht=W({__name:"index",setup(s){const t=A([]);A([]);const e=A(0),a=A([]),o=A([]),p=A([]);E("A1",a),E("A2",o),E("A3",p);const r=A(-1);let h=[];const v=R(()=>r.value>=0&&r.value<h.length?h[r.value]:null);function b(S,_){r.value=S,h[S]=_}function y(){t.value.push({id:"P"+e.value}),h.push({}),e.value++}return(S,_)=>{const $=Gt,g=Ut,F=Jt;return l(),d("div",Qt,[I($,{processes:c(t),activeProcess:c(r),onClicked:b,onAddProcess:y},null,8,["processes","activeProcess"]),I(g,{area:"a1",name:"Array 1",registers:c(a)},null,8,["registers"]),I(g,{area:"a2",name:"Array 2",registers:c(o)},null,8,["registers"]),I(g,{area:"a3",name:"Array 3",registers:c(p)},null,8,["registers"]),I(F,{activeProcess:c(r),state:c(v)},null,8,["activeProcess","state"])])}}}),nn=N(Ht,[["__scopeId","data-v-6ce1c7f3"]]);export{nn as default};
